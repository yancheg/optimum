!function(){"use strict";angular.module("optimum",["ngAnimate","toastr","optimum.routes","optimum.auth","optimum.users"]),angular.module("optimum").config(["$httpProvider",function(a){function b(a,b){return{request:function(a){return b.has("token")&&(a.headers.Token=b.get("token")),a}}}a.interceptors.push("ErrorInterceptor"),a.interceptors.push(b),b.$inject=["$q","webStorage"]}]),angular.module("optimum").run(["$rootScope","toastr",function(a,b){a.$on("loading-error",function(){b.error("loading-error","Probably server is down!")})}])}(),function(){"use strict";function a(a,b,c,d){a.otherwise("/404.html"),b.state("home",{url:"/",templateUrl:"views/homepage.html"}).state("users",{url:"/users/{page}",templateUrl:"scripts/users/views/list.html",controller:"UsersController",controllerAs:"vm",data:{access:d["public"]},resolve:{offset:["$stateParams",function(a){return parseInt(25*((a.page||1)-1))||0}],users:["UserService","offset",function(a,b){return a.getUsersList(b)}],usersCount:["UserService",function(a){return a.getUsersCount()}]}}).state("login",{url:"/login",controller:"AuthController",controllerAs:"vm",templateUrl:"scripts/auth/views/login.html",resolve:{auth:["AuthService","$state","toastr","$q","$timeout",function(a,b,c,d,e){var f=d.defer();return e(function(){a.isAuthenticated()?(b.go("users"),c.info("Already signed up!"),f.reject()):f.resolve()}),f.promise}]}}).state("register",{url:"/reg",controller:"AuthController",controllerAs:"vm",templateUrl:"scripts/auth/views/register.html",resolve:{auth:["AuthService","$state","toastr","$q","$timeout",function(a,b,c,d,e){var f=d.defer();return e(function(){a.isAuthenticated()?(b.go("users"),c.info("Already signed up!"),f.reject()):f.resolve()}),f.promise}]}}).state("logout",{url:"/logout",controller:["AuthService","$state",function(a,b){a.logout(),b.go("home")}]}).state("create",{url:"/api/users/create",resolve:{data:["UserService",function(a){return a.createUser(0)}]}})}function b(a,b,c,d){var e=!1;a.$on("$stateChangeError",function(a,d,f,g){if(console.log(arguments),!e){e=!0;var h=d&&(d.title||d.name||d.loadedTemplateUrl)||"unknown target",i="Error routing to "+h+". "+(g.msg||"");c.warning(i,g),b.go("home")}}),a.$on("$stateChangeStart",function(a,e){e&&e.data&&e.data.access&&(d.hasAccess(e.data.access)||(c.error("Error!","Access denied!"),a.preventDefault(),b.go(d.isAuthenticated()?"home":"login")))})}angular.module("optimum.routes",["ui.router"]),angular.module("optimum.routes").constant("ACCESS.LEVEL",{"public":"user",admin:"admin"}),angular.module("optimum.routes").config(a),a.$inject=["$urlRouterProvider","$stateProvider","$locationProvider","ACCESS.LEVEL"],b.$inject=["$rootScope","$state","toastr","AuthService"],angular.module("optimum.routes").run(b)}(),function(){"use strict";angular.module("optimum").factory("ErrorInterceptor",["$q","$rootScope",function(a,b){return{requestError:function(c){return b.$broadcast("loading-error",c),a.reject(c)},responseError:function(c){return b.$broadcast("loading-error",c),a.reject(c)}}}])}(),function(){"use strict";function a(a){var b=this;b.isAuthenticated=a.isAuthenticated}angular.module("optimum").controller("HeaderController",a),a.$inject=["AuthService"]}(),function(){"use strict";angular.module("optimum.users",["ui.bootstrap","webStorageModule"])}(),function(){"use strict";function a(a,b){a.fbAsyncInit=function(){FB.init({appId:"368311113299106",channelUrl:"app/channel.html",status:!0,cookie:!0,xfbml:!0}),b.watchAuthenticationStatusChange()},function(a){var b,c="facebook-jssdk",d=a.getElementsByTagName("script")[0];a.getElementById(c)||(b=a.createElement("script"),b.id=c,b.async=!0,b.src="//connect.facebook.net/en_US/all.js",d.parentNode.insertBefore(b,d))}(document)}angular.module("optimum.auth",[]),angular.module("optimum.auth").run(a),a.$inject=["$window","AuthService"]}(),function(){"use strict";function a(a){var b=this;b.login=a.login,b.register=a.register,b.facebook=a.getUserInfo}angular.module("optimum.auth").controller("AuthController",a),a.$inject=["AuthService"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){return o&&"admin"==o.role}function h(){return!!o}function i(a){return g()?!0:o&&o.role==a}function j(a){if(a.error)return c({method:"POST",url:"/api/login",data:a});var g=f("getByEmail")(p,a.email);return g?g.password!==a.password?(d.error("Error!","Password incorrect!"),!1):(o=g,b.set("token",o.token),a.remember&&b.set("user",JSON.stringify(o)),void e.go("users")):(d.info("User Not Found!"),!1)}function k(){o=null,b.remove("user"),b.remove("token"),FB.logout()}function l(a){var b=f("getByEmail")(p,a.email);return b?(d.error("Error!","Email already exists!"),!1):void e.go("users")}function m(){FB.Event.subscribe("auth.authResponseChange",function(a){"connected"===a.status&&n()})}function n(){FB.api("/me",function(a){o=a,o.role="user",b.set("user",JSON.stringify(a)),d.success("Facebook!","You've sign uped successfully"),e.go("users")})}var o,p;return o=b.has("user")?JSON.parse(b.get("user")):null,b.has("users")?p=JSON.parse(b.get("users")):c.get("./data/auth.json").success(function(a){p=a,b.set("users",JSON.stringify(a))}),{isAuthenticated:h,hasAccess:i,login:j,logout:k,register:l,watchAuthenticationStatusChange:m}}angular.module("optimum.auth").factory("AuthService",a),a.$inject=["$q","webStorage","$http","toastr","$state","$filter"],angular.module("optimum.auth").filter("getByEmail",function(){return function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c].email==b)return a[c];return null}})}(),function(){"use strict";function a(a,b,c,d,e){var f=this;f.users=b,f.pagination=c,f.edit=function(b,c){d.updateUser(b,c).then(function(b){e.success("User Updated!");var d=a("getIndexById")(f.users,c);f.users[d]=b})},f.filter=function(a){d.filterUsers(a).then(function(a){f.users=a,f.pagination=null})}}angular.module("optimum.users").controller("UsersController",a),a.$inject=["$filter","users","usersCount","UserService","toastr","offset"]}(),function(){"use strict";function a(a,b,c,d,e){function f(c){var d=a.defer();return b({method:"GET",url:"./data/users.json"}).success(function(a){var b=e("filter")(a,{$:c});d.resolve(b)}).error(function(a){d.reject(a)}),d.promise}function g(c){var e=a.defer();return j&&j.length>0?e.resolve(j.slice(c,c+25)):b({method:"GET",url:"./data/users.json"}).success(function(a){j=a,d.set("usersList",JSON.stringify(a)),e.resolve(a.slice(c,c+25))}).error(function(a){e.reject(a)}),e.promise}function h(){var c=a.defer();return b({method:"GET",url:"./data/users.json"}).success(function(a){var b=new Array(a.length/25);c.resolve(b)}).error(function(a){c.reject(a)}),c.promise}function i(b,c){var f=a.defer(),g=e("getIndexById")(j,c);return b.id=c,delete b.object,j[g]=b,d.set("usersList",JSON.stringify(j)),f.resolve(b),f.promise}var j;return d.has("usersList")&&(j=JSON.parse(d.get("usersList"))),{getUsersCount:h,getUsersList:g,updateUser:i,filterUsers:f}}angular.module("optimum.users").factory("UserService",a),a.$inject=["$q","$http","toastr","webStorage","$filter"],angular.module("optimum.users").filter("getIndexById",function(){return function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c].id==b)return c;return null}})}(),function(){"use strict";angular.module("optimum.users").directive("editBtn",["$modal",function(a){return{restrict:"E",template:'<span class="glyphicon glyphicon-edit">Edit</span>',scope:{user:"=",action:"=",index:"="},link:function(b,c){c.bind("click",function(){var c=a.open({animation:!0,templateUrl:"scripts/users/views/edit.html",controller:function(a,b,c){var d=angular.copy(c);a.item=c,a.ok=function(){b.close(a.item)},a.cancel=function(){b.dismiss(d)}},resolve:{item:function(){return angular.copy(b.user)}}});c.result.then(function(a){b.action(a,b.user.id)},function(a){b.user=a})})}}}]),angular.module("optimum.users").directive("searchField",["$timeout",function(a){return{restrict:"A",scope:{action:"="},link:function(b,c){var d;c.bind("keyup",function(){d&&a.cancel(d);var e=c.val();e.length>3&&(d=a(function(){b.action(e)},300))})}}}])}();